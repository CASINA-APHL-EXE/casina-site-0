<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CASINA // FACTORY ONLINE</title>
  <style>
    :root{
      --cyan: 0,255,255;
    }
    html, body { margin: 0; height: 100%; background: #000; overflow: hidden; }
    canvas { position: fixed; inset: 0; width: 100vw; height: 100vh; display:block; }

    /* HUD text */
    .hud{
      position: fixed; left: 18px; top: 16px;
      color: rgba(var(--cyan),0.85);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      letter-spacing: .12em;
      text-transform: uppercase;
      user-select: none;
      pointer-events: none;
      mix-blend-mode: screen;
    }
    .hud .title{ font-size: 14px; opacity: 0.95; }
    .hud .sub{ margin-top: 6px; font-size: 11px; opacity: 0.6; }

    /* Mascot (placeholder circle core) */
    #mascot{
      position: fixed;
      left: 0; top: 0;
      width: 130px; height: 130px;
      border-radius: 999px;
      pointer-events: none;
      transform: translate(-9999px, -9999px);
      background:
        radial-gradient(circle at 35% 35%, rgba(var(--cyan),0.95), rgba(var(--cyan),0.12) 45%, rgba(0,0,0,0) 70%),
        radial-gradient(circle at 60% 60%, rgba(var(--cyan),0.25), rgba(0,0,0,0) 60%);
      box-shadow:
        0 0 18px rgba(var(--cyan),0.25),
        0 0 44px rgba(var(--cyan),0.12);
      filter: drop-shadow(0 0 18px rgba(var(--cyan),0.25));
      mix-blend-mode: screen;
    }
    /* tiny “comic” notch line */
    #mascot::after{
      content:"";
      position:absolute; inset: 12px;
      border-radius: 999px;
      border: 1px solid rgba(var(--cyan),0.16);
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="mascot" aria-hidden="true"></div>

  <div class="hud" aria-hidden="true">
    <div class="title">XERLEVATE // FACTORY ONLINE</div>
    <div class="sub">cyan field · idle drift / cursor cohesion</div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d", { alpha: false });

  // -------- Retina-safe resize --------
  function resize() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width  = Math.floor(innerWidth  * dpr);
    canvas.height = Math.floor(innerHeight * dpr);
    canvas.style.width = innerWidth + "px";
    canvas.style.height = innerHeight + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  addEventListener("resize", resize);
  resize();

  // -------- Mouse state --------
  const mouse = { x: innerWidth/2, y: innerHeight/2, lastMove: 0 };
  const now = () => performance.now();

  function touchMouse(x,y){
    mouse.x = x; mouse.y = y;
    mouse.lastMove = now();
  }
  addEventListener("pointermove", (e)=> touchMouse(e.clientX, e.clientY));
  addEventListener("pointerdown", (e)=> touchMouse(e.clientX, e.clientY));

  // -------- Particles --------
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const rand = (a,b)=>a+Math.random()*(b-a);

  let COUNT = 220;
  function recomputeCount(){
    COUNT = Math.min(260, Math.max(120, Math.floor((innerWidth*innerHeight)/6500)));
  }
  recomputeCount();
  addEventListener("resize", recomputeCount);

  const particles = [];
  function seed() {
    particles.length = 0;
    for (let i=0; i<COUNT; i++) {
      particles.push({
        x: rand(0, innerWidth),
        y: rand(0, innerHeight),
        vx: rand(-0.35, 0.35),
        vy: rand(-0.35, 0.35),
        r: rand(1.2, 2.6),
        phase: rand(0, Math.PI*2),
      });
    }
  }
  seed();

  // -------- Mascot smooth follow --------
  const mascot = document.getElementById("mascot");
  const m = { x: innerWidth/2, y: innerHeight/2, vx:0, vy:0, rot:0 };
  const M_SIZE = 130;
  const SPRING = 0.11;   // snappy
  const DAMP = 0.80;     // float
  const MAX_ROT = 12 * Math.PI/180;

  // -------- Render loop --------
  function frame(t){
    // activity strength: move -> 1, idle -> 0
    const idleMs = t - mouse.lastMove;
    const active = clamp(1 - idleMs / 900, 0, 1);

    // background
    ctx.fillStyle = "#000";
    ctx.fillRect(0,0,innerWidth,innerHeight);

    // subtle glow around cursor when active
    if (active > 0.02) {
      const g = ctx.createRadialGradient(mouse.x, mouse.y, 0, mouse.x, mouse.y, 240);
      g.addColorStop(0, "rgba(0,255,255,0.12)");
      g.addColorStop(1, "rgba(0,255,255,0.00)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,innerWidth,innerHeight);
    }

    const linkDist = 90;

    // particles update & draw
    for (let i=0; i<particles.length; i++){
      const p = particles[i];

      // idle drift
      p.phase += 0.02;
      p.vx += Math.sin(p.phase) * 0.002;
      p.vy += Math.cos(p.phase) * 0.002;

      // attraction when active
      if (active > 0){
        const dx = mouse.x - p.x;
        const dy = mouse.y - p.y;
        const d2 = dx*dx + dy*dy;
        const radius = 280;
        if (d2 < radius*radius){
          const d = Math.sqrt(d2) + 0.0001;
          const pull = (1 - d/radius) * 0.95 * active;
          p.vx += (dx/d) * pull;
          p.vy += (dy/d) * pull;
          // cohesion damping (feel like “凝聚”)
          p.vx *= 0.92;
          p.vy *= 0.92;
        }
      }

      // clamp & move
      p.vx = clamp(p.vx, -1.7, 1.7);
      p.vy = clamp(p.vy, -1.7, 1.7);
      p.x += p.vx;
      p.y += p.vy;

      // wrap
      if (p.x < -30) p.x = innerWidth + 30;
      if (p.x > innerWidth + 30) p.x = -30;
      if (p.y < -30) p.y = innerHeight + 30;
      if (p.y > innerHeight + 30) p.y = -30;

      // links (comic tech web)
      ctx.lineWidth = 1;
      for (let j=i+1; j<particles.length; j++){
        const q = particles[j];
        const dx = q.x - p.x, dy = q.y - p.y;
        const dist = Math.hypot(dx, dy);
        if (dist < linkDist){
          const a = (1 - dist/linkDist) * 0.18;
          ctx.strokeStyle = `rgba(0,255,255,${a})`;
          ctx.beginPath();
          ctx.moveTo(p.x,p.y);
          ctx.lineTo(q.x,q.y);
          ctx.stroke();
        }
      }

      // dot
      ctx.fillStyle = "rgba(0,255,255,0.88)";
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    }

    // -------- mascot follow physics --------
    const targetX = mouse.x;
    const targetY = mouse.y;

    const dx = targetX - m.x;
    const dy = targetY - m.y;
    m.vx = (m.vx + dx*SPRING) * DAMP;
    m.vy = (m.vy + dy*SPRING) * DAMP;
    m.x += m.vx;
    m.y += m.vy;

    const desiredRot = clamp(m.vx * 0.02, -MAX_ROT, MAX_ROT);
    m.rot = m.rot*0.86 + desiredRot*0.14;

    const left = m.x - M_SIZE/2;
    const top  = m.y - M_SIZE/2;

    mascot.style.transform = `translate(${left}px, ${top}px) rotate(${m.rot}rad)`;

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
</script>
</body>
</html>